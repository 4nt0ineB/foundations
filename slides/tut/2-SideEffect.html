<!DOCTYPE html>
<html>
<head>
  <title>Side Effect</title>
  <meta charset="utf-8">
  <style>
    @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
    @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
    @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

    body { font-family: 'Droid Serif'; color: #333333; }
    h1 { font-family: 'Yanone Kaffeesatz'; font-weight: normal; color: #074548; }
    h2, h3 { font-family: 'Yanone Kaffeesatz'; font-weight: normal; color: #6f9a9c; }
    .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    .medium { font-size: 28px; }
    .large { font-size: 36px; }
    .pull-left { float: left; width: 47%; }
    .pull-right { float: right; width: 47%; }
    .large-left { float: left; width: 57%; }
    .small-right { float: right; width: 27%; }
    .medium-right { float: right; width: 37%; }
    .footer { position: absolute; bottom: 12px; left: 45px }
    table { border-collapse: collapse; display: inline-block; }
    th, td { padding: 10px; border: 1px solid black; }
    tr:nth-child(even) {background-color: #f2f2f2;}
    .reference {
    font-size: 16px;
    position: fixed;
    left: 50%;
    bottom: 12px;
    transform: translate(-50%, -50%);
    margin: 0 auto;
    }
  </style>
</head>
<body>
<textarea id="source">

class: center, middle

<a href="https://github.com/fp-tower/foundation">
  <img src="img/solid-color-logo.svg" alt="logo" style="width:600px;"/>
</a>

<br>
<br>


# Side Effect

---
layout: true

<div class="footer">
  <a href="https://github.com/fp-tower/foundation">
    <img src="img/symbol-solid-gray-b3b3b3.svg" alt="logo" style="width:100px;"/>
  </a>
</div>

---
background-image: url(img/sideeffect/function-age.svg)

# Pure function

---
.h1[# How to do something?]

<br>

.large[
* read or write from a file

* save user in database

* send notification to user's phone

* update counter of active users
]

---
class: center, middle

# A pure function cannot DO anything
# it can only produce a VALUE

---
class: center, middle

# Functional Programming is useless *

[Simon Peyton Jones](https://www.reddit.com/r/programming/comments/25m291/simon_peyton_jones_haskell_is_useless/) co-author of haskell

???
He actually said Haskell is useless

---
class: center, middle

# What is the solution?

---
class: center, middle

# Create a VALUE that describes actions

--

# Interpret the value with side effects in Main

---
background-image: url(img/sideeffect/effects-on-edges.svg)

# Run side effects at the edges

---
### 1. Encode Action

```tut:silent
trait Action[A]
```

### 2. Define an unsafe interpreter of Action

```tut:silent
def unsafeRun[A](fa: Action[A]): A = ??? // execute action, this is not a pure function
```

### 3. Combine everything in Main

```tut:silent
object Main extends App {

  val program: Action[Unit] = ???

  unsafeRun(program)

}
```

---
class: center, middle

# Examples

---
.h1[# Cooking]

.pull-left[
### 1. Secret pasta recipe (Program)

.large[
1. Boil 200 ml of water
2. Add 250 g of dry pasta
3. Wait 11 minutes
4. Drain the pasta
]
]
.pull-right[
.h3[### 2. Cook (Unsafe evaluation)]

.large[
Take the recipe and do it at home
]
]

---
background-image: url(img/sideeffect/lemon-meringue-1.svg)

.reference[[Seven Sketches in Compositionality: An Invitation to Applied Category Theory](https://arxiv.org/abs/1803.05316)]

---
background-image: url(img/sideeffect/lemon-meringue-2.svg)

# Cooking compose

.reference[[Seven Sketches in Compositionality: An Invitation to Applied Category Theory](https://arxiv.org/abs/1803.05316)]

---
# Executable program

.center[![Run program](img/sideeffect/program-run.svg)]

<br>

```bash
~/project/foundation ᐅ ls
LICENCE   Makefile  README.MD build.sbt exercises logo      notes     project   slides    target
```

---
# Executable program compose

.center[![Pipe program](img/sideeffect/program-pipe.svg)]

<br>

```bash
~/project/foundation ᐅ ls | grep es
exercis`es`
not`es`
slid`es`
```

---
.h1[# Mathematical formula]

.pull-left[
```tut
val x = 2
val y = 3
val x2 = Math.pow(x, 2)
val y2 = Math.pow(y, 2)
val z  = Math.sqrt(x2 + y2)
```
]

.pull-right[
![Right triangle](img/sideeffect/right-triangle-1.svg)
]

---

.pull-left[
# Mathematical formula

<br>

```tut
val x2 = Math.pow(2, 2)
val y2 = Math.pow(3, 2)
val z  = Math.sqrt(x2 + y2)

val z2 = Math.pow(z, 2)
```
]

.pull-right[
![Right triangle](img/sideeffect/right-triangle-2.svg)
]

.reference[[Constraints Liberate, Liberties Constrain](https://www.youtube.com/watch?v=GqmsQeSzMdw)]

---
.h1[# Separate description from execution]

<br>

.large[
*   Music
*   Architecture
*   Cooking
*   Mathematical formula
*   Docker
*   ...
]

---
class: center, middle

# How to encode actions?

---
# Method 1: Thunk

```tut:silent
import java.time.LocalDate
import scala.io.StdIn

type Thunk[A] = () => A  // Unit => A

val readLine: Thunk[String] =
  () => StdIn.readLine()

def writeLine(message: String): Thunk[Unit] =
  () => println(message)

val localDate: Thunk[LocalDate] =
  () => LocalDate.now()
```

```tut:silent
def unsafeRun[A](fa: Thunk[A]): A = fa()
```

---
# Method 1: IO

```tut:silent
class IO[A](val unsafeRun: () => A)

val readLine: IO[String] =
  new IO(() => StdIn.readLine())

def writeLine(message: String): IO[Unit] =
  new IO(() => println(message))

val localDate: IO[LocalDate] =
  new IO(() => LocalDate.now())
```

```tut
localDate
localDate.unsafeRun()
```


---
class: center, middle

# IO Exercises

`exercises.sideeffect.IOExercises.scala`

---
.h1[# IO Summary]

.large[
* An `IO` is a thunk of potentially impure code

* Composing `IO` is referentially transparent, nothing get executed

* It is better to group `IO` in a interface for testing (see `Console` in `IOExercises`)
]

---
class: center, middle

# What are the limitations of IO?

---
background-image: url(img/sideeffect/io.svg)

# IO cannot be introspected

---
# Algebra

```tut:silent
sealed trait Console[A]
object Console {
  case object ReadLine                  extends Console[String]
  case class WriteLine(message: String) extends Console[Unit]
}
```

```scala
import Console._

def unsafeRun[A](fa: Console[A]): A =
  fa match {
    case ReadLine       => StdIn.readLine()
    case WriteLine(msg) => println(msg)
  }
```

---
# Algebra

```tut:silent
sealed trait Console[A]
object Console {
  case object ReadLine                  extends Console[String]
  case class WriteLine(message: String) extends Console[Unit]
}
```

```scala
def compileToIO[A](fa: Console[A]): IO[A] =
  fa match {
    case ReadLine       => new IO(() => StdIn.readLine())
    case WriteLine(msg) => new IO(() => println(message))
  }

def unsafeRun[A](fa: Console[A]): A =
  compileToIO(fa).unsafeRun()
```

---
# Resources and further study

* [Seven Sketches in Compositionality: An Invitation to Applied Category Theory](https://arxiv.org/abs/1803.05316)
* [Constraints Liberate, Liberties Constrain](https://www.youtube.com/watch?v=GqmsQeSzMdw)


</textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js">
</script>
<script>
    var slideshow = remark.create({
        ratio: "16:9",
        slideNumberFormat: '%current%',
        // highlightStyle: "github",
        highlightLines: true,
        highlightSpans: true,
    });
</script>
</body>
</html>
